<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="theme-color" content="#FFFFFF">
  <meta charset="UTF-8">
  <title>QR Authentication</title>
  <link rel="icon" href="./favicon.svg" type="image/svg+xml">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="frw/bootstrap.min.css">
  <script src="frw/jquery.min.js"></script>
  <script src="frw/bootstrap.bundle.min.js"></script>
  <script src="frw/age.min.js"></script>
  <script src="frw/qrcode.min.js"></script>
  <script src="frw/qr-scanner.legacy.min.js"></script>
  <script src="frw/totp.js"></script>
  <script src="qrauth.js"></script>
  <style>
    .bg-success-highlight {background-color: rgb(0, 255, 0, 0.55);}
    .text-success-highlight {color: #00ff00;}
    input::placeholder {font-size: 0.75em;}
    .form-label {font-size: 0.7em}
    #selHstSrvDst li {
      font-size: small;
    }
  </style>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(registration => console.log('Service Worker Registered', registration))
        .catch(error => console.error('Service Worker Registration Failed', error));
    }
  </script>
</head>
<body data-bs-theme="dark" style="width: 21em">
<div id="mainContainer" class="container m-0 p-1">
  <div class="d-none bg-success-highlight"></div>
  <div class="progress mb-1" role="progressbar" aria-label="Session expiration time" style="height: 0.5em">
    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 0"></div>
  </div>
  <div id="alertIncomatibleQRCodePanel" class="alert alert-danger d-none" role="alert">
    <h4 class="alert-heading">Incompatible QR code</h4><hr>
    <p class="mb-0 text-warning">The scanned QR code does not meet the requirements of this web app....</p>
  </div>

  <div id="openSaveFileArea" class="card mb-2 d-none">
    <div class="card-body m-0 p-3 pt-2">
      <label for="inpFileDataPassword" class="form-label m-0 p-0 w-100">
        Enter password to decrypt/encrypt the file data:
      </label>
      <br>
      <div class="input-group input-group-sm">
        <input id="inpFileDataPassword" type="password" class="form-control" name="password" autocomplete="current-password"
               placeholder="leave empty to not decrypt/encrypt the file data"/>
        <button class="btn btn-outline-secondary" id="btnShowSaveFilePassword" data-bs-target="#inpCurrentPassword">&#x1F441;</button>
      </div>
      <button id="btnOpenFile" class="btn btn-outline-danger btn-lg mt-2">&#128228;&nbsp; Open</button>
      <button id="btnSaveFile" class="btn btn-outline-success btn-lg mt-2">Save &nbsp;&#128229;</button>
      <button id="btnCloseOpenSaveFileArea" class="btn btn-outline-secondary btn-lg mt-2 float-end">&#128076;</button>
    </div>
  </div>

  <form action="#" method="post">
  <div id="cardArea" class="card">
    <div class="card-body m-0 p-0 ms-2 me-2">
      <label for="inpKeyDestination" class="form-label m-0 p-0">
        Destination (obtain from a scanned QR code)
      </label>
      <br>
      <div class="input-group input-group-sm" role="group">
        <input id="inpKeyDestination" type="text" class="form-control ps-2 pe-2" name="username" autocomplete="username"
               placeholder="hostName/serviceName/destinationName">
        <button class="btn btn-outline-secondary d-none" id="btnClearKeyDestination">&#10060;</button>
        <button id="btnKeyDestList" class="btn btn-sm btn-outline-secondary dropdown-toggle"
                type="button" data-bs-toggle="dropdown" aria-expanded="false"></button>
        <ul id="selHstSrvDst" class="dropdown-menu">
          <li><a class="dropdown-item" href="#">host_name/service_name/destination_name</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="#">Open/Save file...</a></li>
        </ul>
      </div>
      <label for="inpCurrentPassword" class="form-label m-0 p-0 d-inline-block w-100">
        The current valid password key for the destination
      </label>
      <br>
      <div class="input-group input-group-sm">
        <input id="inpCurrentPassword" type="password" class="form-control" name="password" autocomplete="current-password"
               placeholder="Enter key or insert it from existed dest by select item in list"/>
        <button class="btn btn-outline-secondary text-success-highlight bg-black d-none" id="labelOTPcode" data-bs-target="#inpCurrentPassword"></button>
        <button class="btn btn-outline-secondary d-none" id="btnClearPassword">&#10060;</button>
        <button class="btn btn-outline-secondary d-none" id="btnRevertPreviousPassword" style="line-height: 0;">
          <span style="font-size: x-large;">&#8634;</span></button>
        <button class="btn btn-outline-secondary" id="btnShowCurrentPassword" data-bs-target="#inpCurrentPassword">&#x1F441;</button>
      </div>
      <label for="inpNewPassword" class="form-label mb-0">
        Change the current password to a new <i id="lblNewPasswordsLength"></i>
      </label>
      <br>
      <div class="input-group input-group-sm mb-3">
        <button class="btn btn-outline-secondary" id="btnGenerateNewPassword">&#127922;</button>
        <input id="inpNewPassword" type="password" class="form-control"
               placeholder="Enter a new key or generate random by dice"/>
        <button class="btn btn-outline-secondary d-none" id="btnClearNewPassword">&#10060;</button>
        <button class="btn btn-outline-secondary d-none" type="submit" id="btnSaveNewPassword">&#128190;</button>
        <button class="btn btn-outline-secondary" id="btnShowNewPassword" data-bs-target="#inpNewPassword">&#x1F441;</button>
      </div>
      <button id="btnScanSessionPubkey" type="button" class="btn btn-lg btn-secondary mb-3 pe-2 ps-2 ms-2" style="width: 6em;">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi float-start" viewBox="0 0 16 16">
          <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"/>
          <path d="M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"/>
          <path d="M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"/>
          <path d="M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"/>
          <path d="M12 9h2V8h-2z"/>
        </svg>
      </button>
      <small id="lblScanQrCode" class="text-black"
             style="font-size: 0.7em; position: absolute; width: 7em; left: 5.7em; margin-top: 0.7em; line-height: 1em">
        make scan<br>QR code of<br>a dest..ion
      </small>
      <button id="btnShowQrCode" type="submit" class="btn btn-lg btn-secondary mb-3 pe-2 ps-2 me-2 float-end bi-qr-code" style="width: 6em;">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="black" class="bi float-end" viewBox="0 0 16 16">
          <path d="M2 2h2v2H2z"/>
          <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>
          <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>
          <path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>
          <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>
        </svg>
      </button>
      <small id="lblQrCreate" class="text-black d-none" style="font-size: 0.7em; position: absolute; width: 7em; right: 5.8em; margin-top: 0.6em; line-height: 1.1em; text-align: right">
        ...then start playing ~<b id="qrChunksQuantity">6</b><br>QR chunks</small>
      <small id="lblQrShow" class="d-none" style="font-size: 0.7em; position: absolute; width: 7em; right: 5.8em; margin-top: 0.6em; line-height: 1.1em; text-align: right">
        show&nbsp; TOTP<br>QR code for<br>the passkey</small>
      <button id="btnSettings" class="btn btn-sm btn-outline-secondary mb-3 ms-2 p-0 pe-2 ps-2"
              data-bs-target="#settingsArea" style="font-size: larger">&equiv;</button>
    </div>
  </div>
  </form>

  <div id="whatTheArea" class="d-none mt-1">
    <div class="card">
      <div class="card-body m-0 p-2 pt-1" style="font-size: 0.7em">
        Brief description.<br>
        This interface is designed to support scripts with a secure key (passphrase) transfer protocol using QR codes.<br>
        <br>
        Key transfer interaction flowchart.<br>
        1. The destination device must generate a QR code containing the public encryption key and some metadata.<br>
        2. Run and scan this QR code. Once you receive the destination path, enter the current authorization key/passphrase. You can also set or generate a new password using the button to change the current one.<br>
        3. Clicking the "Show QR code" button will generate a series of sequential QR codes, which must be shown to the active camera of the destination device.<br>
        <br>
        Data exchange via QR codes is encrypted with a cryptographically strong algorithm. Details and source code can be found on the project page.
      </div>
    </div>
  </div>
  <div id="settingsArea" class="d-none mt-1">
    <div class="card">
      <div class="card-body m-0 p-2 pt-1">
        <div class="row">
          <label for="inpQrChunksRange" class="form-label mb-0 mt-2" style="font-size: 0.7em">
            Number of transmitting QR parts: <b id="lblQrChunksNumber">6</b>
            <span class="float-end me-5 pe-4">[1..62/1]</span>
          </label>
          <div class="d-flex">
            <input id="inpQrChunksRange" type="range" class="form-range me-2" min="1" max="62" value="6">
            <button id="btnQrChunksMinus" class="btn btn-sm btn-primary m-0 me-2 pb-0 pt-0 pe-2 ps-2" data-bs-target="-">&minus;</button>
            <button id="btnQrChunksPlus" class="btn btn-sm btn-primary m-0 pb-0 pt-0 pe-2 ps-2" data-bs-target="+">&plus;</button>
          </div>
        </div>
        <div class="row">
          <label for="inpQrChunkTime" class="form-label mb-0 mt-2" style="font-size: 0.7em">
            Display time per QR part: <b id="lblQrChunkTime">250 ms</b>
            <span class="float-end me-5 pe-4">[50..950/50]</span>
          </label>
          <div class="d-flex">
            <input id="inpQrChunkTime" type="range" class="form-range me-2" min="50" max="1000" step="50" value="250" disabled>
            <button id="btnQrChunkTimeMinus" class="btn btn-sm btn-primary m-0 me-2 pb-0 pt-0 pe-2 ps-2" data-bs-target="-">&minus;</button>
            <button id="btnQrChunkTimePlus" class="btn btn-sm btn-primary m-0 pb-0 pt-0 pe-2 ps-2" data-bs-target="+">&plus;</button>
          </div>
        </div>
        <div class="row mt-3 ms-0">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" role="switch" id="switcherAutoGenNewPassword" disabled>
            <label class="form-check-label" for="switcherAutoGenNewPassword"
                   style="font-size: 0.7em; line-height: 1.2em; position: relative; top: 0.1em">
              Change the current password to a new<br>random one in each session. (<b id="lblAutoRandomPasswordLength">16</b> chars)</label>
            <div class="float-end">
            <button id="btnAutoRandomPasswordLengthMinus" class="btn btn-sm btn-primary m-0 me-1 pb-0 pt-0 pe-2 ps-2" data-bs-target="-">&minus;</button>
            <button id="btnAutoRandomPasswordLengthPlus" class="btn btn-sm btn-primary m-0 pb-0 pt-0 pe-2 ps-2" data-bs-target="+">&plus;</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <video id="qrCodeScannerVideo" class="w-100 d-none p-3"></video>
  <div id="qrCodeImgArea" class="bg-light m-0 pt-4 pb-4 d-none" style="padding-left: 20px"></div>

  <div class="form-check form-switch mt-1 small float-sm-start">
    <input class="form-check-input" type="checkbox" role="switch" id="switcherNetworkMode" disabled>
    <label class="form-check-label" for="switcherNetworkMode"
           style="font-size: 0.7em; line-height: 0.9em; position: relative; top: 0.1em">Network<br>mode</label>
  </div>
  <div class="ms-3 small float-sm-start" style="line-height: 0.5em; position: relative; top: 0.3em">
    <a class="btn-sm" href="intent:#Intent;action=android.settings.SETTINGS;end"
       style="text-decoration: none; font-size: 0.7em; color: white">set USB<br>modem</a>
  </div>
  <div class="input-group input-group-sm p-0 m-0 mt-1 w-auto float-end">
    <button class="btn p-0 m-0 ps-1 pe-1 btn-outline-secondary" type="button" style="font-size: 0.7em" data-bs-target="#whatTheArea"
            id="btnShowHelp">WhatThe?</button>
    <input type="text" class="form-control p-0 m-0 ps-2 pe-2"
           style="font-weight: lighter; font-size: x-small; width: 10em; text-align: end"
           value="v.1.2.2 (20260118)" id="labelVersion" aria-describedby="btnUpdateVersion" aria-label="version">
    <button class="btn btn-secondary p-0 m-0 ps-1 pe-1" type="button" style="height: 1.5em; color: black"
            id="btnUpdateVersion">&#10227;</button>
  </div>

</div>
</body>
</html>
